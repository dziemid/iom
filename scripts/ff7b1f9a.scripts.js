"use strict";function splitLine(a,b){for(var c="",d=a;d.length>b;){var e=d.substring(0,b),f=e.lastIndexOf(" "),g=e.lastIndexOf("\n");-1!=g&&(f=g),-1==f&&(f=b),c+=e.substring(0,f)+"\n",d=d.substring(f+1)}return c+d}function setCaretPosition(a,b){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}function existingMaps(){for(var a=new Array,b=0,c=localStorage.length;c>b;++b)a.push(localStorage.key(b));return a}function currentMapKey(a){return a||"iom"}function initialState(a){var b=localStorage.getItem(currentMapKey(a.search().iomname));return null!=b&&""!=b?b:(introJs().start(),"Goal \n    Critical success factor 1\n        Necessary Condition 1\n    Critical success factor 2\n        Necessary Condition 2\n    Critical success factor 3\n        Necessary Condition 2\n        Necessary Condition 3\n  ")}angular.module("iomApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.keypress"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),console.log(introJs());var IDENT=4;String.prototype.repeat=function(a){return new Array(a+1).join(this)},angular.module("iomApp").controller("MainCtrl",["$scope","$sce","$location",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.maps=existingMaps(),a.keypressCallback=function(b){var c=b.target.selectionStart;if(console.log(b.target),9==b.which){var d=[a.spaceFormat.slice(0,c)," ".repeat(IDENT),a.spaceFormat.slice(c)].join("");b.target.value=d,setCaretPosition(b.target,c+IDENT)}if(13==b.which){var e=b.target.value.split("\n"),f=b.target.value.substr(0,b.target.selectionStart).split("\n").length-1,g=e[f].trimLeft(),h=(e[f].length-g.length)/IDENT;console.log(g+h);var d=[a.spaceFormat.slice(0,c),"\n"+" ".repeat(h*IDENT),a.spaceFormat.slice(c)].join("");b.target.value=d,setCaretPosition(b.target,c+1+h*IDENT)}a.spaceFormat=b.target.value,b.preventDefault()},a.spaceFormat=initialState(c),a.svg='<i class="fa fa-circle-o-notch fa-spin"></i> loading...',a.$watch("spaceFormat",_.debounce(function(){a.$apply(function(){a.redraw()})},400)),a.show_help=function(){console.log("test"),introJs().start()},a.delete_map=function(a){localStorage.removeItem(a)},a.redraw=function(){var d=a.spaceFormat;localStorage.setItem(currentMapKey(c.search().iomname),d);var e=d.replace(/\"/g,"'").split("\n"),f=null,g=null,h=0,i=null,j=null,k=e.length,l=null,m=null,n=new Array;a.dotFormat="digraph testgraph{ \n                 node [ shape=box, fontname=Arial, fontcolor=blue, fontsize=9];         graph [  ];         ";for(var o=0;k>o;o++)f=e[o],g=f.trimLeft(),h=(f.length-g.length)/IDENT,g=splitLine(g,22),n[h]=g,0==h&&(l=g),h>i&&(l=j,m=g),i==h&&(m=g),i>h&&(l=n[h-1],m=g),null!=l&&null!=m&&""!=l&&""!=m&&(a.dotFormat+='"'+l+'" -> "'+m+'"\n'),i=h,j=g;a.dotFormat+="}",a.svg=b.trustAsHtml(Viz(a.dotFormat,"svg"))}}]);